# 研发

## 产品(开发)生命周期
> 适用于不同规模和软硬件

| 阶段 | 名称 | 一句话 | 示例(车) | 输出 | 追溯 |
| - | - | - | - | - | - |
| 需求策划 | 需求收集和分析 | 用户和市场要什么 | 我希望比步行更快地往返于两地，且能遮风挡雨 | 用户需求等各种市场需求 | / |
| 需求分析 | 产品需求分析/产品设计 | 做什么产品满足需求 | 需要一款小型机动交通工具，能防风防雨，用于个人或少量人短途出行。 | 产品需求 | 市场需求 |
| 需求分析 | 系统分析(可选) | 有哪些系统需求 | 交通工具需满足：最高时速≥60km/h； 能承载1-5人；具备封闭座舱，续航≥100km；能在普通公路行驶。 | 系统需求规格说明书，测试计划 | 产品需求 |
| 设计 | 系统设计-架构设计(可选) | 系统整体架构 | 采用‘电机 + 电池 + 轮式驱动’的架构：以锂电池组为能量源，通过电机控制器逆变器将直流电转为交流电驱动永磁同步电机，电机输出的动力经减速器减速器和传动轴传递至4个车轮，搭配电子转向助力转向系统、液压制动系统和封闭车身。 | 架构设计说明书 | 系统需求 |
| 设计 | 系统设计-概要设计 | 系统组件(子系统、模块)概设及其关系 | 5个子系统：动力系统（锂电池组、驱动电机、电机控制器）；传动系统（减速器、传动轴）；行驶系统（车轮、悬架、轮胎）；控制系统（电子转向机、制动踏板、ESP 车身稳定系统）；车身系统（座舱、门窗、充电接口）。<br/> 明确子系统间接口（如电机控制器与驱动电机的电力传输协议、减速器与传动轴的机械连接规格） | 概要设计说明书 | 架构设计 |
| 设计 | 系统设计-详细设计(可选) | 系统组件(子系统、模块)详细实现细节 | 动力系统：搭载60kWh三元锂电池组，能量密度210Wh/kg，支持最高80kW直流快充；驱动电机采用永磁同步电机，最大功率150kW，最高转速16000rpm | 详细设计说明书，测试用例 | 概要设计 |
| 开发实现 | 实现 |  |  | / |  |
| 测试验证 | 集成测试 |  |  | 测试用例，测试报告 |  |
| 测试验证 | 系统测试 |  |  | 测试用例，测试报告 |  |
| 发布 | 版本发布 |  |  | 版本 |  |
| 发布 | 产品发布 |  |  | 产品使用手册 |  |

### 软硬件的内容差异
| 名称 | 硬件 | 软件 |
| - | - | - |
| 详细设计 | 机械图纸、电路原理图、PCB布局、BOM表... | 模块逻辑、接口定义... |
| 开发实现 | 机械结构、电路板... | 代码，单元测试 |

### 大型复杂系统的设计周期
> 软件、硬件和系统(软硬件)都是一样的生命周期，只是**大型复杂系统**会通过**子系统拆分**和**软硬件细化**来降低复杂度，如：

```
系统级
  产品需求文档(就这1个PRD)，系统需求规格说明书(SRS)，系统架构设计说明书
XX子系统
  子系统级：系统需求规格说明书(SSRS)，系统架构设计说明书
  子系统软件：软件系统需求规格说明书，软件概要设计说明书，软件详细设计说明书
  子系统硬件：硬件系统需求规格说明书，硬件概要设计说明书，硬件详细设计说明书
```

## 文档(软件)
* 需求文档 ：[BRD和MRD和PRD](https://www.zhihu.com/question/19655491), [MRD框架和模板](https://zhuanlan.zhihu.com/p/57413137)

| 项 | 一句话 | 定位 | 内容 |
| - | - | - | - |
| 商业需求文档(BRD) | 做吗 | 公司战略，决定商业价值 | 业务需求和项目范围，商业模式和ROI |
| 市场需求文档(MRD) | 市场要什么 | 公司战略分解实现 | 客户、用户、市场的需求，通过原型形象化 |
| 产品需求文档(PRD) | 产品做什么 | 执行，决定产品水平 | 产品功能和技术规格 |
| 系统需求文档(SRD) | 系统做什么 | 执行，决定成本和质量 | 系统功能和技术规格 |

* 所有文档

| 文档 | 内容结构 | 说明 | 示例(电商订单系统) |
| :-: | - | - | - |
| 市场需求文档(MRD) |  |  |  |
| 产品需求文档(PRD) | 产品的目标，用户故事，用户界面（UI）的草图，以及一些关键的业务和产品需求。 | 产品经理负责。指导开发团队理解产品的目标和产品需求 |
| 系统需求规格说明书(SRS) | 理解和定义系统的需求，包括功能需求、非功能需求(如性能需求)，设计约束等。 <br> 包括用例图，活动图，序列图等 | 目标和约束。系统分析师或开发者负责。指导开发团队进行系统设计和编码 | 功能需求：用户可创建订单、查询订单、取消订单；系统需自动计算订单金额（含优惠券折扣）。 <br/> 非功能需求：订单查询响应时间≤1秒；支持日均100万订单创建；数据需保存3年。 <br/> 接口需求：需与支付系统、库存系统对接（例如，创建订单前需调用库存系统检查库存）。 |
| 架构设计文档 | 系统的总体架构、核心组件及其功能、组件间关系(分工协作)、核心流程；技术选型；性能目标(如可扩展性、安全性) <br> 包括系统架构图 | 系统的总体骨架和技术选型 | 逻辑架构：订单系统分为 “订单核心模块”“优惠券模块”“库存交互模块”“支付交互模块”，采用分层架构（表现层→业务层→数据层）。 <br/> 技术选型：后端用 Java+Spring Cloud（微服务），数据库用 MySQL（主从架构），缓存用 Redis（存储热门订单），消息队列用 Kafka（异步处理订单状态变更）。 <br/> 高可用策略：核心服务多实例部署，通过负载均衡（Nginx）分流；Redis 集群保证缓存不宕机。 |
| 概要设计文档 | 分解大组件成组件，定义组件职责、接口和交互逻辑 <br> 包括包图，接口定义等 | 系统模块划分和协作规则 | 模块划分：“订单核心模块” 拆分为 “订单创建子模块”“订单查询子模块”“订单取消子模块”。 <br/> 模块职责：“订单创建子模块” 负责接收用户下单请求、校验参数、调用库存检查接口；“订单查询子模块” 负责接收查询请求、从 MySQL/Redis 获取数据并返回。 <br/> 接口定义：“订单创建子模块” 与 “库存交互模块” 的接口为checkStock(skuId, quantity)，输入为商品 ID 和数量，输出为 “是否有库存（布尔值）”。 |
| 详细设计文档 | 系统组件的具体实现。 <br> 包括具体的数据结构，算法、方案，接口，类和方法的设计等。包括类图，状态图等 | 如有组件结构调整（如分解出子组件），则概要设计需调整 |

* 文档模板 : 本仓库目录/dev/design/s/tpl/

## 跟踪矩阵
* 产品经理，研发经理，测试经理

### 需求跟踪矩阵(RTM)
* 系统需求和测试用例都来自产品需求

| 用户需求编码 | 产品需求编码(PRD功能点编码) | 系统需求编码 | 测试用例编码 |
| - | - | - | - |

### 开发跟踪矩阵
| 系统需求编码 | 概要设计编码(模块编码) | 详细设计编码 | 开发任务编号 |
| - | - | - | - |

### 测试跟踪矩阵
| 测试用例编码 | Bug编号 |
| - | - |

## 研发管理
* 通过研发管理系统(如禅道)进行研发管理(需求，任务)

### 需求拆分
> 将抽象需求转化为可执行的开发/测试任务。**设计文档的价值**

#### 传统开发模式
* 拆分法：**需求 → 功能点 → 任务**
    * 需求可以是**产品需求或系统需求**
    * **功能点**用途是处理复杂需求时的“解耦和明确边界”。所以简单的系统需求拆分可以忽略功能点，但产品需求和复杂的系统需求拆分要三层
    * **需求 → 功能点**是概要设计
    * **功能点 → 任务**是详细设计。任务从详细设计的技术细节中“拆解”出来的，比如功能接口“拆解”出A任务“接口A开发”和“接口A测试”

* **完整拆分示例**：系统需求是远程手术系统需记录手术操作日志，包含操作人、时间、动作类型

| 功能 | 任务 |
| - | - |
| 功能点1：日志数据采集（实时记录操作人 ID、时间戳、动作编码） |  |
| 功能点2：日志存储（写入数据库，支持按时间范围查询） | T01：设计日志表结构（字段：id、user_id、action_type、timestamp）→ 后端开发 <br/> T02：开发日志写入接口（POST /api/logs，参数校验）→ 后端开发 <br/> T03：开发按时间查询接口（GET /api/logs?start=xxx&end=xxx）→ 后端开发 <br/> T04：编写接口测试用例（验证写入成功、查询正确）→ 测试工程师 |
| 功能点3：日志展示（前端表格展示，支持筛选和导出） |  |

* **从详细设计文档到任务的拆解示例：**
  * 详细设计文档中“用户注册功能”
  ```
  1. 前端页面：手机号输入框（需校验格式）、密码框（需校验强度）、注册按钮（点击后调用后端接口）
  2. 后端接口：POST /api/register，参数为 phone（字符串）、password（字符串）。返回注册结果（成功 / 失败原因）
  3. 后端逻辑：
      1. 校验手机号是否已注册，注册时字段是True
      2. 校验密码强度（至少 8 位，含大小写 + 数字）
      3. 密码加密（用 BCrypt）
      4. 写入 user 表（生成 user_id，默认角色为普通用户）
  4. 测试要点：重复注册、密码弱、参数为空等场景。
  ```
  * 拆解出来任务（非直接“取出”）

  | 详细设计文档 | 角色 | 任务 |
  | - | - | - |
  | 1 | 前端 | 开发注册页面（含手机号格式校验、密码强度校验） |
  | 2 | 后端 | 开发 POST /api/register 接口（定义参数、返回格式） |
  | 3.1 | 后端 | 开发手机号唯一性校验逻辑（查询 user 表） |
  | 3.2 | 后端 | 开发密码强度校验工具函数 |
  | 3.3 | 后端 | 集成BCrypt加密算法并应用于密码存储 |
  | 3.4 | 后端 | 编写user表插入逻辑（生成 user_id、默认角色） |
  | 4 | 测试 | 编写注册功能测试用例（覆盖重复注册、弱密码等场景） |

#### 敏捷开发模式
* 拆分法：**故事 → 任务**